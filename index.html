<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="YuChen Chai">
<!--  高德地图API-->
  <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
  <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.14&key=2ef52157e7e81867dbc9c4b1b0b84e92&plugin=AMap.Driving,AMap.Transfer,AMap.Riding,AMap.Walking"></script>

  <title>欢迎来到郑东新区实验——一个MIT的城市实验</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


  <!-- Custom styles for this template -->
  <link href="css/modern-business.css" rel="stylesheet">
  <link href="css/own-style.css" rel="stylesheet">

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <img src="resource/MIT_Logo.jpg" height="30px" style="padding-right: 5px">
      <a class="navbar-brand" href="index.html">郑东新区实验</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="about.html">关于实验</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contact.html">团队成员</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contact.html">联系我们</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <header>
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
      </ol>
      <div class="carousel-inner" role="listbox">
        <!-- Slide One - Set the background image for this slide in the line below -->
        <div class="carousel-item active" style="background-image: url('./resource/Display-Slide-1.jpg')">
          <div class="carousel-caption d-none d-md-block">
            <h3>First Slide</h3>
            <p>This is a description for the first slide.</p>
          </div>
        </div>
<!--         Slide Two - Set the background image for this slide in the line below -->
        <div class="carousel-item" style="background-image: url('./resource/Display-Slide-2.jpg')">
          <div class="carousel-caption d-none d-md-block">
            <h3>Second Slide</h3>
            <p>This is a description for the second slide.</p>
          </div>
        </div>
        <!-- Slide Three - Set the background image for this slide in the line below -->
        <div class="carousel-item" style="background-image: url('./resource/Display-Slide-3.jpg')">
          <div class="carousel-caption d-none d-md-block">
            <h3>Third Slide</h3>
            <p>This is a description for the third slide.</p>
          </div>
        </div>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </header>

  <!-- Page Content -->

  <div class="container">
    <h1 class="my-2">欢迎参与郑东新区实验！</h1>
    <h5 class="my-2">我们将根据你的起始位置和终点位置，为你提供各种可行方案以供参考</h5>
    <br>
    <div style="width:1000px;height:34px;">
      <input id="QuestionID" type="text" placeholder="问卷ID"  style="height:25px;width:220px"/>
      <input id="Start" type="text" placeholder="起点"  style="height:25px;width:220px"/>
      <input id="End" type="text" placeholder="终点"  style="height:25px;width:220px"/>
      <select class="mSelect" id="MSelect" onchange="getValue()"   style="height:25px;width: 220px">
        <option value ="0">无附加功能</option>
        <option value ="1">卡路里消耗</option>
        <option value="2">温室气体</option>
        <option value="3">污染暴露</option>
      </select>
      <input type="button" id="result" value="查询"/>
<!--      <a class="mButton" href="#">查询</a> -->
    </div>
    <br>

    <table id=mtable border="solid" width="100%" height="15px" cellspacing="0" cellpadding="5">
      <thead>

      <tr align="center" valign="center" bgcolor=#fefefe>
        <th></th>
        <th colspan="2">机动车</th>
        <th></th>
        <th colspan="3">公共交通</th>
        <th></th>
        <th colspan="2">骑行/走路</th>
      </tr>
      <tr align="center" valign="center" bgcolor=#fefefe>
        <th></th>
        <th>自驾车</th>
        <th>出租车</th>
        <th></th>
        <th>公交车</th>
        <th>地铁</th>
        <th>步行</th>
        <th></th>
        <th>骑行</th>
        <th>步行</th>
      </tr>
      </thead>

      <tr align="center" valign="center" bgcolor=#fefefe>
        <th>时间(分钟)</th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr align="center" valign="center" bgcolor=#fefefe>
        <th>距离(公里)</th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr align="center" valign="center" bgcolor=#fefefe>
        <th>成本(元)</th>
        <td></td>
        <td></td>
        <td></td>
        <td colspan="3"></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr id="Options1" align="center" valign="center" bgcolor=#fefefe style="visibility: hidden">
        <th>卡路里消耗(卡)</th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr id="Options2" align="center" valign="center" bgcolor=#fefefe style="visibility: hidden">
        <th>温室气体(克)</th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr id="Options3" align="center" valign="center" bgcolor=#fefefe style="visibility: hidden">
        <th>PM2.5暴露量(微克/立方米*分钟)</th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr id="Options4" align="center" valign="center" bgcolor=#fefefe style="visibility: hidden">
        <th>等价吸烟数量(根)</th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>

    </table>

    <br>
    <div>
      <div class="mGrid" style="display:inline-block">
        <h5 class="my-text">自驾车及出租车路径规划</h5>
      </div>
      <div id="map-1">
         <div id="panel1" ></div>
       </div>
    </div>

    <br>

    <div>
      <div class="mGrid" style="display:inline-block">
        <h5 class="my-text">公交车及地铁路径规划</h5>
      </div>
      <div id="map-2">
        <div id="panel2" ></div>
      </div>
    </div>

    <br>

    <div>
      <div class="mGrid" style="display:inline-block">
        <h5 class="my-text">骑行路径规划</h5>
      </div>
      <div id="map-4">
        <div id="panel4" ></div>
      </div>
    </div>

    <br>

    <div>
      <div class="mGrid" style="display:inline-block">
        <h5 class="my-text">步行路径规划</h5>
      </div>
      <div id="map-5">
        <div id="panel5" ></div>
      </div>
    </div>
  </div>

  <br>
  <!-- /.container -->

  <!-- Footer -->
  <footer class="py-5 bg-dark">
    <div class="container">
      <p class="m-0 text-center text-white">Copyright &copy; YuChen Chai 2019</p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>



<script>
  var mcity="郑州";
  var center_x=113.657413;
  var center_y=34.867203;
  var QueryCode={
    LocalSearch:1,
    SendPost:2,
    PostDelete:3,
  }
  var selectValue=0;
  var mJsonData={};
  var options={};
  options["Health"]={};
  options["Health"]["Private"]=0;
  options["Health"]["Taxi"]=0;
  options["Health"]["TBus"]=0;
  options["Health"]["TSubway"]=0;
  options["Health"]["TWalk"]=0;
  options["Health"]["Bike"]=0;
  options["Health"]["Walk"]=0;

  options["Social"]={};
  options["Social"]["Private"]=0;
  options["Social"]["Taxi"]=0;
  options["Social"]["TBus"]=0;
  options["Social"]["TSubway"]=0;
  options["Social"]["TWalk"]=0;
  options["Social"]["Bike"]=0;
  options["Social"]["Walk"]=0;

  options["Pollution1"]={};
  options["Pollution1"]["Private"]=0;
  options["Pollution1"]["Taxi"]=0;
  options["Pollution1"]["TBus"]=0;
  options["Pollution1"]["TSubway"]=0;
  options["Pollution1"]["TWalk"]=0;
  options["Pollution1"]["Bike"]=0;
  options["Pollution1"]["Walk"]=0;

  options["Pollution2"]={};
  options["Pollution2"]["Private"]=0;
  options["Pollution2"]["Taxi"]=0;
  options["Pollution2"]["TBus"]=0;
  options["Pollution2"]["TSubway"]=0;
  options["Pollution2"]["TWalk"]=0;
  options["Pollution2"]["Bike"]=0;
  options["Pollution2"]["Walk"]=0;

  $("#result").click(function(){
    mJsonData={};
    mJsonData["Driving"]={"Self":{},"Taxi":{}};
    mJsonData["Transfer"]={"Bus":{},"Subway":{},"Walk":{}};
    mJsonData["Ride"]={"Walk":{},"Ride":{}};
  var start = $("#Start").val();
  var end = $("#End").val();
  var questionID = $("#QuestionID").val();

  mJsonData["Id"]=questionID;

  console.log(start);
  var sendPost=QueryCode.SendPost;

  if(questionID==""&&start==""&&end=="")
  {
    return;
  }
  else if(questionID=="")
  {
    sendPost=QueryCode.LocalSearch;
  }
  else if(start==""&&end=="")
  {
    sendPost=QueryCode.PostDelete;
  }
  else
  {
    sendPost=QueryCode.SendPost;
  }

    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    //自驾车API处理
    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    driving.search([
      {keyword: start,city:mcity,extensions:"all"},
      {keyword: end,city:mcity,extensions:"all"},

    ], function(status, result) {
      // result 即是对应的驾车导航信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_DrivingResult
      if (status === 'complete') {
        // console.log(result);
        var tb=document.getElementById("mtable");
        var t=Math.round(result.routes[0].time/60);
        var dist=(result.routes[0].distance/1000).toFixed(1);

        var td=tb.rows[2].cells[1];
        td.innerHTML=t;
        var td=tb.rows[3].cells[1];
        td.innerHTML=dist;
        var td=tb.rows[5].cells[1];
        td.innerHTML=(dist*3.5).toFixed(1);
        var td=tb.rows[6].cells[1];
        td.innerHTML=(dist*270.57).toFixed(1);
        var td=tb.rows[7].cells[1];
        td.innerHTML=(t*0.152*200).toFixed(1);
        var td=tb.rows[8].cells[1];
        td.innerHTML=(t*0.152*200/22/24/60).toFixed(2);

        var td=tb.rows[2].cells[2];
        td.innerHTML=t;
        var td=tb.rows[3].cells[2];
        td.innerHTML=dist;
        var td=tb.rows[5].cells[2];
        td.innerHTML=(dist*3.5).toFixed(1);
        var td=tb.rows[6].cells[2];
        td.innerHTML=(dist*270.57).toFixed(1);
        var td=tb.rows[7].cells[2];
        td.innerHTML=(t*0.152*200).toFixed(1);
        var td=tb.rows[8].cells[2];
        td.innerHTML=(t*0.152*200/22/24/60).toFixed(2);

        mJsonData["Driving"]["Self"]["Time"]=t;
        mJsonData["Driving"]["Self"]["Distance"]=parseFloat(dist);

        mJsonData["Driving"]["Taxi"]["Time"]=t;
        mJsonData["Driving"]["Taxi"]["Distance"]=parseFloat(dist);


        log.success('绘制驾车路线完成')
      } else {
        log.error('获取驾车数据失败：' + result)
      }
    });

    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    //公共交通API处理
    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    transfer.search([
      {keyword: start,city:mcity},
      //第一个元素city缺省时取transOptions的city属性
      {keyword: end,city:mcity}
      //第二个元素city缺省时取transOptions的cityd属性
    ], function(status, result) {

      // result即是对应的公交路线数据信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_TransferResult
      if (status === 'complete') {
         console.log(result);
        var tb=document.getElementById("mtable");
        var t=Math.round(result.plans[0].time/60);

        var bus_dist=0;
        var subway_dist=0;
        var walk_dist=0;
        var bus_t=0;
        var subway_t=0;
        var walk_t=0;

        var mPlan=result.plans[0].segments;
        for(var i=0;i<mPlan.length;i++)
        {
          switch(mPlan[i].transit_mode)
          {
            case "WALK":
              walk_dist=walk_dist+mPlan[i].distance;
              walk_t=walk_t+mPlan[i].time;
              break;
            case "SUBWAY":
              subway_dist=subway_dist+mPlan[i].distance;
              subway_t=subway_t+mPlan[i].time;
              break;
            case "BUS":
              bus_dist=bus_dist+mPlan[i].distance;
              bus_t=bus_t+mPlan[i].time;
              break;
          }
        }
        bus_dist=(bus_dist/1000).toFixed(1);
        subway_dist=(subway_dist/1000).toFixed(1);
        walk_dist=(walk_dist/1000).toFixed(1);

        bus_t=Math.round(bus_t/60);
        subway_t=Math.round(subway_t/60);
        walk_t=Math.round(walk_t/60);

        var c=Math.round(result.plans[0].cost);

        var td=tb.rows[2].cells[4];
        td.innerHTML=bus_t;
        var td=tb.rows[3].cells[4];
        td.innerHTML=bus_dist;
        var td=tb.rows[5].cells[4];
        td.innerHTML=(bus_dist*5).toFixed(1);
        var td=tb.rows[6].cells[4];
        td.innerHTML=(bus_dist*180.38).toFixed(1);
        var td=tb.rows[7].cells[4];
        td.innerHTML=(bus_t*0.72*200).toFixed(1);
        var td=tb.rows[8].cells[4];
        td.innerHTML=(bus_t*0.72*200/22/24/60).toFixed(2);

        var td=tb.rows[2].cells[5];
        td.innerHTML=subway_t;
        var td=tb.rows[3].cells[5];
        td.innerHTML=subway_dist;
        var td=tb.rows[5].cells[5];
        td.innerHTML=(subway_dist*5).toFixed(1);
        var td=tb.rows[6].cells[5];
        td.innerHTML=(subway_dist*101.466).toFixed(1);
        var td=tb.rows[7].cells[5];
        td.innerHTML=(subway_t*0.3283*200).toFixed(1);
        var td=tb.rows[8].cells[5];
        td.innerHTML=(subway_t*0.3283*200/22/24/60).toFixed(2);

        var td=tb.rows[2].cells[6];
        td.innerHTML=walk_t;
        var td=tb.rows[3].cells[6];
        td.innerHTML=walk_dist;
        var td=tb.rows[5].cells[6];
        td.innerHTML=(walk_dist*73).toFixed(1);
        var td=tb.rows[6].cells[6];
        td.innerHTML=(walk_dist*0).toFixed(1);
        var td=tb.rows[7].cells[6];
        td.innerHTML=(walk_t*1*200).toFixed(1);
        var td=tb.rows[8].cells[6];
        td.innerHTML=(walk_t*1*200/22/24/60).toFixed(2);

        var td=tb.rows[4].cells[4];
        td.innerHTML=c;

        var td=tb.rows[4].cells[2];
        td.innerHTML=result.taxi_cost;

        mJsonData["Driving"]["Taxi"]["Cost"]=result.taxi_cost;

        mJsonData["Transfer"]["Time"]=t;
        mJsonData["Transfer"]["Cost"]=c;
        mJsonData["Transfer"]["Bus"]["Dist"]=bus_dist;
        mJsonData["Transfer"]["Subway"]["Dist"]=subway_dist;
        mJsonData["Transfer"]["Walk"]["Dist"]=walk_dist;


        log.success('绘制公交路线完成')
      } else {
        log.error('公交路线数据查询失败' + result)
      }
    });

    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    //骑行API处理
    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    riding.search([
      {keyword:start,city:mcity},
      {keyword: end,city:mcity}
    ], function(status,result) {
      // result即是对应的骑行路线数据信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_RidingResult
      if (status === 'complete') {
        // console.log(result);
        var tb=document.getElementById("mtable");
        var t=Math.round(result.routes[0].time/60);
        var dist=(result.routes[0].distance/1000).toFixed(1);

        var td=tb.rows[2].cells[8];
        td.innerHTML=t;
        var td=tb.rows[3].cells[8];
        td.innerHTML=dist;
        var td=tb.rows[5].cells[8];
        td.innerHTML=(dist*30).toFixed(1);
        var td=tb.rows[6].cells[8];
        td.innerHTML=(dist*0).toFixed(1);
        var td=tb.rows[7].cells[8];
        td.innerHTML=(t*1*200).toFixed(1);
        var td=tb.rows[8].cells[8];
        td.innerHTML=(t*1*200/22/24/60).toFixed(2);

        mJsonData["Ride"]["Ride"]["Dist"]=dist;
        mJsonData["Ride"]["Ride"]["Time"]=t;

        log.success('绘制骑行路线完成')
      } else {
        log.error('骑行路线数据查询失败' + result)
      }
    });

    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    //步行API处理
    //===== ===== ===== ===== ===== ===== ===== ===== ===== =====
    walking.search([
      {keyword: start,city:mcity},
      {keyword: end,city:mcity}
    ], function(status, result) {
      // result即是对应的步行路线数据信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_WalkingResult
      if (status === 'complete') {
        // console.log(result);
        var tb=document.getElementById("mtable");
        var t=Math.round(result.routes[0].time/60);
        var dist=(result.routes[0].distance/1000).toFixed(1);

        var td=tb.rows[2].cells[9];
        td.innerHTML=t;
        var td=tb.rows[3].cells[9];
        td.innerHTML=dist;
        var td=tb.rows[5].cells[9];
        td.innerHTML=(dist*73).toFixed(1);
        var td=tb.rows[6].cells[9];
        td.innerHTML=(dist*0).toFixed(1);
        var td=tb.rows[7].cells[9];
        td.innerHTML=(t*1*200).toFixed(1);
        var td=tb.rows[8].cells[9];
        td.innerHTML=(t*1*200/22/24/60).toFixed(2);

        mJsonData["Ride"]["Walk"]["Dist"]=dist;
        mJsonData["Ride"]["Walk"]["Time"]=t;

        log.success('绘制步行路线完成')
      } else {
        log.error('步行路线数据查询失败' + result)
      }
    });

    mJsonData["QueryCode"]=sendPost;
    console.log(mJsonData);

    sendData=function(){
      var mdata=JSON.stringify(mJsonData);
      console.log(mdata)
      $.post("http://localhost:8000/",mdata,function(data,status){
        console.log(data)
      })
    }

    setTimeout(sendData,5000);
  });
</script>
<script type="text/javascript">
  getValue=function()
  {
    selectValue=$("#MSelect").val();
    console.log(selectValue);
    if(selectValue==0)
    {
      document.getElementById("Options1").style.visibility="hidden";
      document.getElementById("Options2").style.visibility="hidden";
      document.getElementById("Options3").style.visibility="hidden";
      document.getElementById("Options4").style.visibility="hidden";
    }
    else if(selectValue==1)
    {
      document.getElementById("Options1").style.visibility="visible";
      document.getElementById("Options2").style.visibility="hidden";
      document.getElementById("Options3").style.visibility="hidden";
      document.getElementById("Options4").style.visibility="hidden";
    }
    else if(selectValue==2)
    {
      document.getElementById("Options2").style.visibility="visible";
      document.getElementById("Options1").style.visibility="hidden";
      document.getElementById("Options3").style.visibility="hidden";
      document.getElementById("Options4").style.visibility="hidden";
    }
    else
    {
      document.getElementById("Options3").style.visibility="visible";
      document.getElementById("Options4").style.visibility="visible";
      document.getElementById("Options1").style.visibility="hidden";
      document.getElementById("Options2").style.visibility="hidden";
    }
  }
</script>

<script type="text/javascript">
TaxiPrice=function(dis,time){
  if(dis<=2)
    return 8;
  else if(dis<=12)
    return (8+(dis-2)*1.5).toFixed(1);
  else
    // console.log((8+15+(dis-12)*2.25).toFixed(1))
    return (8+15+(dis-12)*2.25).toFixed(1);
}
</script>

<script type="text/javascript">
  //基本地图加载
  var map1 = new AMap.Map("map-1", {
    resizeEnable: true,
    center: [center_x, center_y],//地图中心点
    zoom: 13 //地图显示的缩放级别
  });
  //构造路线导航类
  var driving = new AMap.Driving({
    map: map1,
    panel: "panel1"
  });
</script>

<script type="text/javascript">
  var map2 = new AMap.Map("map-2", {
    resizeEnable: true,
    center: [center_x, center_y],//地图中心点
    zoom: 13
  });
  var transOptions = {
    map: map2,
    city: mcity,
    panel: 'panel2',
    policy: AMap.TransferPolicy.LEAST_TIME //乘车策略
    // policy: AMap.TransferPolicy.NO_SUBWAY //乘车策略
  };
  //构造公交换乘类
  var transfer = new AMap.Transfer(transOptions);

</script>

<script type="text/javascript">
  var map = new AMap.Map("map-4", {
    resizeEnable: true,
    center: [center_x,center_y],//地图中心点
    zoom: 13 //地图显示的缩放级别
  });
  //步行导航
  var riding = new AMap.Riding({
    map: map,
    panel: "panel4"
  });
</script>

<script type="text/javascript">
  var map = new AMap.Map("map-5", {
    resizeEnable: true,
    center: [center_x, center_y],//地图中心点
    zoom: 13 //地图显示的缩放级别
  });
  //步行导航
  var walking = new AMap.Walking({
    map: map,
    panel: "panel5"
  });
  $("#result").click(function(){

  });

</script>